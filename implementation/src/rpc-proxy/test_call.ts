// import { Common, Chain, Hardfork } from '@ethereumjs/common';
// import { VM } from '@ethereumjs/vm';
// import {
//   Address,
//   Account,
//   isTruthy,
//   toType,
//   bufferToHex,
//   isFalsy,
//   toBuffer,
//   TypeOutput,
// } from '@ethereumjs/util';
// import { VerifiedStateManager } from './customStateManager';

// export interface RpcTx {
//   from?: string
//   to?: string
//   gas?: string
//   gasPrice?: string
//   value?: string
//   data?: string
// };

// export const INTERNAL_ERROR = -32603;

// const common = new Common({ chain: Chain.Mainnet, hardfork: Hardfork.Istanbul });

// const addr = '0x369E32aed1Dc5c33C85ab20977fB645A803E4A70';

// async function call(params: [RpcTx, string]) {
//   const [transaction, blockOpt] = params
//   // const block = await getBlockByOption(blockOpt, this._chain)

//   // if (isFalsy(this._vm)) {
//   //   throw new Error('missing vm')
//   // }

//   // const vm = await this._vm.copy()
//   // await vm.stateManager.setStateRoot(block.header.stateRoot)
//   const stateManager = new VerifiedStateManager();
//   const vm = await VM.create({ common, stateManager });

//   // await vm.stateManager.checkpoint()
//   // const address = new Address(Buffer.from(addr.slice(2), 'hex'))
//   // const account = Account.fromAccountData({ nonce: "0x2", balance: "0x1" })
//   // await vm.stateManager.putAccount(address, account)
//   // await vm.stateManager.commit()

//   const { from, to, gas: gasLimit, gasPrice, value, data } = transaction

//   try {
//     const runCallOpts = {
//       caller: isTruthy(from) ? Address.fromString(from) : undefined,
//       to: isTruthy(to) ? Address.fromString(to) : undefined,
//       gasLimit: toType(gasLimit, TypeOutput.BigInt),
//       gasPrice: toType(gasPrice, TypeOutput.BigInt),
//       value: toType(value, TypeOutput.BigInt),
//       data: isTruthy(data) ? toBuffer(data) : undefined,
//     }
//     const { execResult } = await vm.evm.runCall(runCallOpts);
//     // console.log(execResult);
//     return bufferToHex(execResult.returnValue)
//   } catch (error: any) {
//     throw {
//       code: INTERNAL_ERROR,
//       message: error.message.toString(),
//     }
//   }
// }

// // async function eth_call() {
// //   const vm = await VM.create({ common });
// //   console.log(vm);
// // }

// // const transferTx = {
// //   // from: addr,
// //   to: '0xb1f8e55c7f64d203c1400b9d8555d050f94adf39',
// //   // value: '0x1',
// //   data: '0xf0002ea9000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000001000000000000000000000000369e32aed1dc5c33c85ab20977fb645a803e4a7000000000000000000000000000000000000000000000000000000000000003e8000000000000000000000000c011a73ee8576fb46f5e1c5751ca3b9fe0af2a6f0000000000000000000000000bc529c00c6401aef6d220be8c6ea1667f6ad93e000000000000000000000000408e41876cccdc0f92210600ef50372656052a380000000000000000000000009f8f72aa9304c8b593d555f12ef6589cc3a579a2000000000000000000000000514910771af9ca656af840dff83e8264ecf986ca00000000000000000000000004fa0d235c4abf4bcf4787af4cf447de572ef828000000000000000000000000bbbbca6a901c926f240b89eacb641d8aec7aeafd000000000000000000000000d533a949740bb3306d119cc777fa900ba034cd52000000000000000000000000c00e94cb662c3520282e6f5717214004a7f26888000000000000000000000000ba100000625a3754423978a60c9317c58a424e3d0000000000000000000000007fc66500c84a76ad7e9c93437bfc5ac33e2ddae9000000000000000000000000e41d2489571d322189246dafa5ebde1f4699f49800000000000000000000000057ab1ec28d129707052df4df418d58a2d46d5f510000000000000000000000006b3595068778dd592e39a122f4f5a5cf09c90fe2000000000000000000000000fe18be6b3bd88a2d2a7f928d00292e7a9963cfc6000000000000000000000000eb4c2781e4eba804ce9a9803c67d0893436bb27d000000000000000000000000a3bed4e1c75d00fa6f4e5e6922db7261b5e9acd2000000000000000000000000b8baa0e4287890a5f79863ab62b7f175cecbd4330000000000000000000000001f573d6fb3f13d689ff844b4ce37794d79a7ff1c000000000000000000000000f629cbd94d3791c9250152bd8dfbdf380e2a3b9c0000000000000000000000000d8775f648430679a709e98d2b0cb6250d2887ef00000000000000000000000080fb784b7ed66730e8b1dbd9820afd29931aab030000000000000000000000001494ca1f11d487c2bbe4543e90080aeba4ba3c2b000000000000000000000000a0246c9032bc3a600820415ae600c6388619a14d000000000000000000000000ec67005c4e498ec7f55e092bd1d35cbc47c9189200000000000000000000000056d811088235f11c8920698a204a5010a788f4b30000000000000000000000001776e1f26f98b1a5df9cd347953a26dd3cb46671000000000000000000000000d46ba6d942050d489dbd938a2c909a5d5039a1610000000000000000000000006810e776880c02933d47db1b9fc05908e5386b960000000000000000000000008f8221afbb33998d8584a2b05749ba73c37a938a00000000000000000000000089d24a6b4ccb1b6faa2625fe562bdd9a23260359000000000000000000000000d26114cd6ee289accf82350c8d8487fedb8a0c070000000000000000000000004fabb145d64652a948d72533023f6e7a623c7c530000000000000000000000000f5d2fb29fb7d3cfee444a200298f468908cc9420000000000000000000000000000000000085d4780b73119b644ae5ecd22b3760000000000000000000000004ddc2d193948926d02f9b1fe9e1daa0718270ed500000000000000000000000039aa39c021dfbae8fac545936693ac917d5e75630000000000000000000000005d3a536e4d6dbd6114cc1ead35777bab948e36430000000000000000000000005e74c9036fb86bd7ecdcb084a0673efc32ea31cb000000000000000000000000e2f2a5c287993345a840db3b0845fbc70f5935a500000000000000000000000085eee30c52b0b379b046fb0f85f4f3dc3009afec00000000000000000000000027054b13b1b798b345b591a4d22e6562d47ea75a000000000000000000000000c12d099be31567add4e4e4d0d45691c3f58f56630000000000000000000000000954906da0bf32d5479e25f46056d22f08464cab000000000000000000000000e5caef4af8780e59df925470b050fb23c43ca68c000000000000000000000000b753428af26e81097e7fd17f40c88aaa3e04902c0000000000000000000000004c19596f5aaff459fa38b0f7ed92f11ae6543784000000000000000000000000bc396689893d065f41bc2c6ecbee5e00852334470000000000000000000000002ba592f78db6436527729929aaf6c908497cb20000000000000000000000000095ad61b0a150d79219dcf64e1e6cc01f0b64c4ce000000000000000000000000584bc13c7d411c00c01a62e8019472de68768430000000000000000000000000a1faa113cbe53436df28ff0aee54275c13b4097500000000000000000000000043044f861ec040db59a7e324c40507addb6731420000000000000000000000008ce9137d39326ad0cd6491fb5cc0cba0e089b6a90000000000000000000000000ae055097c6d159879521c384f1d2123d1f195e6000000000000000000000000476c5e26a75bd202a9683ffd34359c0cc15be0ff000000000000000000000000056fd409e1d7a124bd7017459dfea2f387b6d5cd000000000000000000000000a1d65e8fb6e87b60feccbc582f7f97804b725521000000000000000000000000a0b73e1ff0b80914ab6fe0444e65848c4c34450b0000000000000000000000008a9c67fee641579deba04928c4bc45f66e26343a0000000000000000000000008400d94a5cb0fa0d041a3788e395285d61c9ee5e0000000000000000000000005228a22e72ccc52d415ecfd199f99d0665e7733b000000000000000000000000aaaf91d9b90df800df4f55c205fd6989c977e73a000000000000000000000000595832f8fc6bf59c85c527fec3740a1b7a361269000000000000000000000000744d70fdbe2ba4cf95131626614a1763df805b9e000000000000000000000000607f4c5bb672230e8672085532f7e901544a73750000000000000000000000004fe83213d56308330ec302a8bd641f1d0113a4cc000000000000000000000000419d0d8bdd9af5e606ae2232ed285aff190e711b00000000000000000000000000c83aecc790e8a4453e5dd3b0b4b3680501a7a700000000000000000000000058b6a8a3302369daec383334672404ee733ab2390000000000000000000000004946fcea7c692606e8908002e55a582af44ac1210000000000000000000000000000000000b3f879cb30fe243b4dfee438691c040000000000000000000000005adc961d6ac3f7062d2ea45fefb8d8167d44b190000000000000000000000000123151402076fc819b7564510989e475c9cd93ca000000000000000000000000b64ef51c888972c908cfacf59b47c1afbc0ab8ac0000000000000000000000004e15361fd6b4bb609fa63c81a2be19d87371787000000000000000000000000042d6622dece394b54999fbd73d108123806f6a180000000000000000000000000abdace70d3790235af448c88547603b945604ea0000000000000000000000000316eb71485b0ab14103307bf65a021042c6d3800000000000000000000000008daebade922df735c38c80c7ebd708af50815faa00000000000000000000000095a4492f028aa1fd432ea71146b433e7b444661100000000000000000000000020c36f062a31865bed8a5b1e512d9a1a20aa333a000000000000000000000000a89ac6e529acf391cfbbd377f3ac9d93eae9664e00000000000000000000000020945ca1df56d237fd40036d47e866c7dccd2114000000000000000000000000ad32a8e6220741182940c5abf610bde99e737b2d00000000000000000000000083e6f1e41cdd28eaceb20cb649155049fac3d5aa00000000000000000000000023b608675a2b2fb1890d3abbd85c5775c51691d5000000000000000000000000ca1207647ff814039530d7d35df0e1dd2e91fa84000000000000000000000000429881672b9ae42b8eba0e26cd9c73711b891ca5000000000000000000000000c28e27870558cf22add83540d2126da2e4b464c20000000000000000000000007968bc6a03017ea2de509aaa816f163db0f35148000000000000000000000000f8c3527cc04340b208c854e985240c02f7b7793f00000000000000000000000033d0568941c0c64ff7e0fb4fba0b11bd37deed9f000000000000000000000000e28b3b32b6c345a34ff64674606124dd5aceca300000000000000000000000002edf094db69d6dcd487f1b3db9febe2eec0dd4c500000000000000000000000043dfc4159d86f3a37a5a4b3d4580b888ad7d4ddd0000000000000000000000000258f474786ddfd37abce6df6bbb1dd5dfc4434a00000000000000000000000062359ed7505efc61ff1d56fef82158ccaffa23d7000000000000000000000000b1f66997a5760428d3a87d68b90bfe0ae64121cc0000000000000000000000000327112423f3a68efdf1fcf402f6c5cb9f7c33fd000000000000000000000000b3319f5d18bc0d84dd1b4825dcde5d5f7266d4070000000000000000000000006c8c6b02e7b2be14d4fa6022dfd6d75921d90e4e000000000000000000000000196f4727526ea7fb1e17b2071b3d8eaa38486988000000000000000000000000ed0439eacf4c4965ae4613d77a5c2efe10e5f1830000000000000000000000004e352cf164e64adcbad318c3a1e222e9eba4ce42000000000000000000000000f4cd3d3fda8d7fd6c5a500203e38640a70bf957700000000000000000000000030f271c9e86d2b7d00a6376cd96a1cfbd5f0b9b3000000000000000000000000a3d58c4e56fedcae3a7c43a725aee9a71f0ece4e0000000000000000000000000e29e5abbb5fd88e28b2d355774e73bd47de3bcd00000000000000000000000089ab32156e46f46d02ade3fecbe5fc4243b9aaed00000000000000000000000084ca8bc7997272c7cfb4d0cd3d55cd942b3c941900000000000000000000000038e4adb44ef08f22f5b5b76a8f0c2d0dcbe7dca1000000000000000000000000431ad2ff6a9c365805ebad47ee021148d6f7dbe0000000000000000000000000b705268213d593b8fd88d3fdeff93aff5cbdcfae0000000000000000000000008ab7404063ec4dbcfd4598215992dc3f8ec853d7000000000000000000000000a1d0e215a23d7030842fc67ce582a6afa3ccab830000000000000000000000000cec1a9154ff802e7934fc916ed7ca50bde6844e00000000000000000000000069a95185ee2a045cdc4bcd1b1df10710395e4e23000000000000000000000000491604c0fdf08347dd1fa4ee062a822a5dd06b5d0000000000000000000000000f51bb10119727a7e5ea3538074fb341f56b09ad0000000000000000000000003a880652f47bfaa771908c07dd8673a787daed3a00000000000000000000000055296f69f40ea6d20e478533c15a6b08b654e7580000000000000000000000003432b6a60d23ca0dfca7761b7ab56459d9c964d0000000000000000000000000940a2db1b7008b6c776d4faaca729d6d4a4aa551000000000000000000000000aa4e3edb11afa93c41db59842b29de64b72e355b000000000000000000000000de4ee8057785a7e8e800db58f9784845a5c2cbd6000000000000000000000000275f5ad03be0fa221b4c6649b8aee09a42d9412a000000000000000000000000f406f7a9046793267bc276908778b29563323996000000000000000000000000aa7a9ca87d3694b5755f213b5d04094b8d0f0a6f000000000000000000000000dbdb4d16eda451d0503b854cf79d55697f90c8df000000000000000000000000875773784af8135ea0ef43b5a374aad105c5d39e0000000000000000000000008290333cef9e6d528dd5618fb97a76f268f3edd4000000000000000000000000b62132e35a6c13ee1ee0f84dc5d40bad8d8152060000000000000000000000003155ba85d5f96b2d030a4966af206230e46849cb0000000000000000000000006dea81c8171d0ba574754ef6f8b412f2ed88c54d0000000000000000000000003506424f91fd33084466f402d5d97f05f8e3b4af00000000000000000000000072e9d9038ce484ee986fea183f8d8df93f9ada13000000000000000000000000888888888889c00c67689029d7856aac1065ec110000000000000000000000006c28aef8977c9b773996d0e8376d2ee379446f2f00000000000000000000000045804880de22913dafe09f4980848ece6ecbaf78000000000000000000000000ebd9d99a3982d547c5bb4db7e3b1f9f14b67eb830000000000000000000000004691937a7508860f876c9c0a2a617e7d9e945d4b000000000000000000000000d291e7a03283640fdc51b121ac401383a46cc62300000000000000000000000086772b1409b61c639eaac9ba0acfbb6e238e5f830000000000000000000000008888801af4d980682e47f1a9036e589479e835c50000000000000000000000000391d2021f89dc339f60fff84546ea23e337750f0000000000000000000000001337def18c680af1f9f45cbcab6309562975b1dd0000000000000000000000001337def16f9b486faed0293eb623dc8395dfe46a000000000000000000000000725c263e32c72ddc3a19bea12c5a0479a81ee6880000000000000000000000003affcca64c2a6f4e3b6bd9c64cd2c969efd1ecbe000000000000000000000000b9ef770b6a5e12e45983c5d80545258aa38f3b78000000',
// //   gas: '0xfffffffffffff',
// //   gasPrice: '0x0'
// // }


